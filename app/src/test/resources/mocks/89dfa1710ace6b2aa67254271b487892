{"url":"https://api.github.com/gists/89dfa1710ace6b2aa67254271b487892","forks_url":"https://api.github.com/gists/89dfa1710ace6b2aa67254271b487892/forks","commits_url":"https://api.github.com/gists/89dfa1710ace6b2aa67254271b487892/commits","id":"89dfa1710ace6b2aa67254271b487892","git_pull_url":"https://gist.github.com/89dfa1710ace6b2aa67254271b487892.git","git_push_url":"https://gist.github.com/89dfa1710ace6b2aa67254271b487892.git","html_url":"https://gist.github.com/89dfa1710ace6b2aa67254271b487892","files":{"untrusted-lvl20-solution.js":{"filename":"untrusted-lvl20-solution.js","type":"application/javascript","language":"JavaScript","raw_url":"https://gist.githubusercontent.com/anonymous/89dfa1710ace6b2aa67254271b487892/raw/da7b13e46530457531f982897e8eaa468425580f/untrusted-lvl20-solution.js","size":4369,"truncated":false,"content":"\n/*****************\n * bossFight.js *\n *****************\n *\n * NO FARTHER, DR. EVAL!!!!\n * YOU WILL NOT GET OUT OF HERE ALIVE!!!!\n * IT'S TIME YOU SEE MY TRUE FORM!!!!\n * FACE MY ROBOT WRATH!!!!!\n */\n\nfunction startLevel(map) {\n    map.defineObject('boss', {\n        'type': 'dynamic',\n        'symbol': 'âŠ™',\n        'color': 'red',\n        'interval': 200,\n        'onCollision': function (player) {\n            player.killedBy('the boss');\n        },\n        'behavior': function (me) {\n            if (!me.direction) {\n                me.direction = 'right';\n            }\n            if (me.canMove(me.direction)) {\n                me.move(me.direction);\n            } else {\n                me.direction = (me.direction == 'right') ? 'left' : 'right';\n            }\n            if (Math.random() < 0.3) {\n                map.placeObject(me.getX(), me.getY() + 2, 'bullet');\n            }\n        },\n        'onDestroy': function (me) {\n            if (map.countObjects('boss') == 0) {\n                map.placeObject(me.getX(), me.getY(), 'theAlgorithm');\n            }\n        }\n    });\n\n    map.defineObject('bullet', {\n        'type': 'dynamic',\n        'symbol': '.',\n        'color': 'red',\n        'interval': 100,\n        'projectile': true,\n        'behavior': function (me) {\n            me.move('down');\n        }\n    });\n\n    map.placePlayer(0, map.getHeight() - 3);\n    map.placeObject(map.getWidth() - 1, map.getHeight() - 1, 'exit');\n\n    // Not so tough now, huh?\n    map.getPlayer().removeItem('phone');\n    map.placeObject(map.getWidth() - 1, map.getHeight() - 3, 'phone');\n\n    map.placeObject(0, map.getHeight() - 4, 'block');\n    map.placeObject(1, map.getHeight() - 4, 'block');\n    map.placeObject(2, map.getHeight() - 4, 'block');\n    map.placeObject(2, map.getHeight() - 3, 'block');\n    map.placeObject(map.getWidth() - 1, map.getHeight() - 4, 'block');\n    map.placeObject(map.getWidth() - 2, map.getHeight() - 4, 'block');\n    map.placeObject(map.getWidth() - 3, map.getHeight() - 4, 'block');\n    map.placeObject(map.getWidth() - 3, map.getHeight() - 3, 'block');\n\n    for (var x = 0; x < map.getWidth(); x++) {\n        map.placeObject(x, 4, 'block');\n    }\n\n    map.placeObject(9, 5, 'boss');\n    map.placeObject(11, 5, 'boss');\n    map.placeObject(13, 5, 'boss');\n    map.placeObject(15, 5, 'boss');\n    map.placeObject(17, 5, 'boss');\n    map.placeObject(19, 5, 'boss');\n    map.placeObject(21, 5, 'boss');\n    map.placeObject(23, 5, 'boss');\n    map.placeObject(25, 5, 'boss');\n    map.placeObject(27, 5, 'boss');\n    map.placeObject(29, 5, 'boss');\n    map.placeObject(31, 5, 'boss');\n\n    map.placeObject(10, 6, 'boss');\n    map.placeObject(12, 6, 'boss');\n    map.placeObject(14, 6, 'boss');\n    map.placeObject(16, 6, 'boss');\n    map.placeObject(18, 6, 'boss');\n    map.placeObject(20, 6, 'boss');\n    map.placeObject(22, 6, 'boss');\n    map.placeObject(24, 6, 'boss');\n    map.placeObject(26, 6, 'boss');\n    map.placeObject(28, 6, 'boss');\n    map.placeObject(30, 6, 'boss');\n\n\n\n\n\n\nfor (var x = 0; x < map.getWidth(); x++) {\n         if (x != 20) {map.placeObject(x, 20, 'tree');}\n    }\n\nmap.defineObject('playerbullet', {\n        'type': 'dynamic',\n        'symbol': '.',\n        'color': 'blue',\n        'interval': 100,\n        'projectile': true,\n        'behavior': function (me) {\n            me.move('up');\n        }\n    });\n    \nfunction fire() {\nfor (var x = 0; x < map.getWidth(); x++) {\n        map.placeObject(x, 7, 'playerbullet');\n    }\n\n}\n\nmap.getPlayer().setPhoneCallback(fire);\n\n\n\n\n\n\n\n\n}\n\nfunction validateLevel(map) {\n    // called at start of level and whenever a callback executes\n    map.validateAtMostXObjects(59, 'block');\n    map.validateAtMostXObjects(1, 'phone');\n\n    if (map.countObjects('theAlgorithm') > 0 && map.countObjects('boss') > 0) {\n        throw \"The Algorithm can only be dropped by the boss!\";\n    }\n\n    // only called at start of level\n    if (map.isStartOfLevel()) {\n        map.validateAtMostXDynamicObjects(23);\n        map.validateNoTimers();\n    }\n}\n\nfunction onExit(map) {\n    if (!map.getPlayer().hasItem('theAlgorithm')) {\n        map.writeStatus(\"You must take back the Algorithm!!\");\n        return false;\n    } else if (!map.getPlayer().hasItem('phone')) {\n        map.writeStatus(\"We need the phone!\");\n        return false;\n    } else {\n        return true;\n    }\n}\n "}},"public":true,"created_at":"2017-03-08T16:49:34Z","updated_at":"2017-03-08T16:49:34Z","description":"Solution to level 20 in Untrusted: http://alex.nisnevich.com/untrusted/","comments":0,"user":null,"comments_url":"https://api.github.com/gists/89dfa1710ace6b2aa67254271b487892/comments","forks":[],"history":[{"user":{"login":"invalid-email-address","id":148100,"avatar_url":"https://avatars3.githubusercontent.com/u/148100?v=3","gravatar_id":"","url":"https://api.github.com/users/invalid-email-address","html_url":"https://github.com/invalid-email-address","followers_url":"https://api.github.com/users/invalid-email-address/followers","following_url":"https://api.github.com/users/invalid-email-address/following{/other_user}","gists_url":"https://api.github.com/users/invalid-email-address/gists{/gist_id}","starred_url":"https://api.github.com/users/invalid-email-address/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/invalid-email-address/subscriptions","organizations_url":"https://api.github.com/users/invalid-email-address/orgs","repos_url":"https://api.github.com/users/invalid-email-address/repos","events_url":"https://api.github.com/users/invalid-email-address/events{/privacy}","received_events_url":"https://api.github.com/users/invalid-email-address/received_events","type":"User","site_admin":false},"version":"55e4339b10f1fbf53244c9ad5433a46e2dfc1d7a","committed_at":"2017-03-08T16:49:33Z","change_status":{"total":162,"additions":162,"deletions":0},"url":"https://api.github.com/gists/89dfa1710ace6b2aa67254271b487892/55e4339b10f1fbf53244c9ad5433a46e2dfc1d7a"}],"truncated":false}